<!-- <mat-form-field appearance="fill">
    <mat-label>Toppings</mat-label>
    <mat-select [formControl]="toppings" multiple>
        <mat-select-trigger>
            {{toppings.value ? toppings.value[0] : ''}}
            <span *ngIf="toppings.value?.length > 1" class="example-additional-selection">
                (+{{toppings.value.length - 1}} {{toppings.value?.length === 2 ? 'other' : 'others'}})
            </span>
        </mat-select-trigger>
        <mat-option *ngFor="let topping of toppingList" [value]="topping">{{topping}}</mat-option>
    </mat-select>
</mat-form-field> -->
<!-- //////////////////////////////////////////////////////// -->
<!-- <h3>Multiple selection</h3>
<p>
    <mat-form-field>
        <mat-select [formControl]="bankMultiCtrl" placeholder="Banks" [multiple]="true" #multiSelect>
            <mat-option>
                <ngx-mat-select-search [formControl]="bankMultiFilterCtrl"></ngx-mat-select-search>
            </mat-option>
            <mat-option *ngFor="let bank of filteredBanksMulti | async" [value]="bank">
                <img class="avatar" aria-hidden src="assets\img\avatar27-sm.jpg" height="25">
                <span class="ml-2">{{bank.name}}</span>
            </mat-option>
        </mat-select>
    </mat-form-field>
</p>
<p>
    Selected Banks:
</p>
<ul *ngFor="let bank of bankMultiCtrl?.value">
    <li>{{bank.name}}</li>
</ul> -->
<button pButton  routerLink="/newproject" label=" Add new Project" class="btn btn-success mt-4 mb-4"><i class="pi pi-plus"></i></button>
<p-dialog [closeOnEscape]="false" header="Task Details" [style]="{width: '450px', height: '70%'}"
    [(visible)]="displayDetailTaskDialog">
    <ng-template pTemplate="content" *ngIf="currentProject && taskForUpdate && userOfSelectedTask">
        <div class="d-flex flex-row">
            <div class="p-2"><i class="pi pi-user"></i> Creator : <b><i>{{userOfSelectedTask.firstName | titlecase}}
                        {{userOfSelectedTask.lastName | titlecase}}</i></b></div>
            <div class="p-2"><i class="pi pi-calendar"></i> Created Date : <b>{{taskForUpdate.createdDate}}</b></div>
        </div>
        <div class="dropdown-divider mt-4 mb-4"></div>
        <div class="p-field">
            <div class="d-flex flex-row">
                <div class="p-2"><i class="pi pi-star"><b> Review : </b></i></div>
                <div class="p-2">
                    <p-rating [disabled]="Ondetails" [(ngModel)]="taskForUpdate.score" [cancel]="false"
                        [readonly]="lc.getCurrentUser() === currentProject.creator ?  false : true ">
                    </p-rating>
                </div>
            </div>
        </div>
        <div class="p-field">
            <mat-form-field style="width: 370px;">
                <mat-label>Title</mat-label>
                <input [disabled]="Ondetails" [(ngModel)]="taskForUpdate.name" autofocus matInput
                    placeholder="Ex.. Task title">
            </mat-form-field>
        </div>
        <div class="p-field">
            <mat-form-field style="width: 370px;">
                <mat-label>tags</mat-label>
                <input [disabled]="Ondetails" [(ngModel)]="taskForUpdate.tags" matInput placeholder="Ex.. Tags name">
            </mat-form-field>
        </div>
        <div class="p-field">
            <mat-form-field style="width: 370px;" appearance="fill">
                <mat-label>Enter a date range</mat-label>
                <mat-date-range-input [rangePicker]="picker">
                    <input [disabled]="Ondetails" [(ngModel)]="taskForUpdate.startDate" matStartDate
                        placeholder="Start date">
                    <input [disabled]="Ondetails" [(ngModel)]="taskForUpdate.dueDate" matEndDate placeholder="End date">
                </mat-date-range-input>
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>
        </div>
        <div class="dropdown-divider mt-1 mb-1"></div>
        <div class="p-field">
            <div>
                <h5><b>Select priority</b></h5>
                <p-dropdown [disabled]="Ondetails" [(ngModel)]="taskForUpdate.priority" [style]="{width: '370px'}"
                    id="prioritys" [options]="prioritys" optionLabel="viewValue" optionValue="value"></p-dropdown>
            </div>
            <div>
                <h5><b>Select Statu :</b></h5>
                <p-dropdown [disabled]="Ondetails" [(ngModel)]="taskForUpdate.status" [style]="{width: '370px'}"
                    id="status" [options]="status" optionLabel="viewValue" optionValue="value"></p-dropdown>
            </div>
        </div>
        <div class="dropdown-divider mt-1 mb-3"></div>
        <div *ngIf="!Ondetails" class="p-field">
            <mat-form-field style="width: 370px;" appearance="fill">
                <mat-label><i class="pi pi-user"></i> Members :</mat-label>
                <mat-select [(ngModel)]="taskForUpdate.membres" multiple>
                    <mat-option *ngFor="let user of currentProject.membres" [value]="user">{{user.firstName}}
                        {{user.lastName}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <div *ngIf="Ondetails" class="p-field">
            <h5>Members</h5>
            <div class="d-flex flex-column">
                <div *ngFor="let user of taskForUpdate.membres" class="p-2">
                    <p-avatar pBadge value="4" severity="danger" image="assets/img/author-page.jpg"></p-avatar>
                    <b>    :  {{user.firstName}}   {{user.lastName}}</b>
                </div>
            </div>
        </div>
        <div class="p-field">
            <mat-form-field style="width: 370px;">
                <mat-label>description :</mat-label>
                <textarea [disabled]="Ondetails" [(ngModel)]="taskForUpdate.description" matInput
                    placeholder="Ex. It makes me feel..."></textarea>
            </mat-form-field>
        </div>
    </ng-template>
    <ng-template pTemplate="footer">
        <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text"
            (click)="displayDetailTaskDialog=false;displayDetailTaskDialog = false"></button>
        <button [disabled]="Ondetails" (click)="OnEditSelectedTask(taskForUpdate,currentProject)" pButton pRipple
            label="Save" icon="pi pi-check" class="p-button-text"></button>
    </ng-template>
</p-dialog>
<p-confirmDialog [style]="{width: '50vw'}" [baseZIndex]="10000" rejectButtonStyleClass="p-button-text">
</p-confirmDialog>
<p-table [value]="projectsList" dataKey="name">
    <ng-template pTemplate="header">
        <tr>
            <th style="width: 3rem"></th>
            <th pSortableColumn="name2">Name <p-sortIcon field="name2"></p-sortIcon>
            </th>
            <th>membres</th>
            <th pSortableColumn="deadline">deadline <p-sortIcon field="deadline"></p-sortIcon>
            </th>
            <th pSortableColumn="status">status <p-sortIcon field="status"></p-sortIcon>
            </th>
            <th pSortableColumn="progress">progress <p-sortIcon field="progress"></p-sortIcon>
            </th>
            <th pSortableColumn="createdDate">created Date <p-sortIcon field="createdDate"></p-sortIcon>
            </th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-project let-expanded="expanded">
        <tr>
            <td>
                <button type="button" pButton pRipple [pRowToggler]="project"
                    class="p-button-text p-button-rounded p-button-plain"
                    [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
            </td>
            <td>

                <span pTooltip="Preview" tooltipPosition="top">{{project.name}}</span>
            </td>
            <td>
                <p-avatarGroup styleClass="p-mb-3">
                    <p-avatar pTooltip="{{member.firstName}} {{member.lastName}}" tooltipPosition="top"
                        *ngFor="let member of project.membres| slice:0:3" image="assets/img/author-page.jpg"
                        shape="circle">
                    </p-avatar>
                    <p-avatar *ngIf="project.membres.length >3" label="{{'+'}}{{project.membres.length-3}}"
                        shape="circle" [style]="{'background-color':'#9c27b0', 'color': '#ffffff'}">
                    </p-avatar>
                </p-avatarGroup>
            </td>
            <td>{{project.deadline}}</td>
            <td>{{project.status}}</td>
            <td>
                <p-progressBar [value]="project.progress"></p-progressBar>

                <!-- <p>{{project.progress}}</p> -->
            </td>
            <td><span>{{project.createdDate}}</span>
            </td>
        </tr>
    </ng-template>
    <ng-template pTemplate="rowexpansion" let-project>
        <tr>
            <td colspan="7">
                <div class="p-p-3">
                    <p-table [scrollable]="true" [style]="{width:'auto'}" [value]="project.tasks" dataKey="name">
                        <ng-template pTemplate="colgroup" let-columns>
                            <colgroup>
                                <col style="width: 3rem;">
                                <col style="width:250px">
                                <col style="width:250px">
                                <col style="width: 125px;">
                                <col style="width: 125px;">
                                <col style="width:160px">
                                <col style="width:250px">
                                <col style="width:250px">
                                <col style="width:250px">

                                <col style="width:6rem">
                            </colgroup>
                        </ng-template>
                        <ng-template pTemplate="header">
        <tr>
            <th>#</th>
            <th pSortableColumn="name">Title <p-sortIcon field="name"></p-sortIcon>
            </th>
            <th pSortableColumn="members">Members<p-sortIcon field="members"></p-sortIcon>
            </th>
            <th pSortableColumn="priority">priority <p-sortIcon field="priority"></p-sortIcon>

            <th pSortableColumn="status">Status <p-sortIcon field="status"></p-sortIcon>
            </th>
            <th pSortableColumn="score">Rating <p-sortIcon field="score"></p-sortIcon>
            </th>
            <th pSortableColumn="startDate">start Date <p-sortIcon field="startDate">
                </p-sortIcon>
            </th>
            <th pSortableColumn="dueDate">due Date <p-sortIcon field="dueDate"></p-sortIcon>
            </th>
            <th pSortableColumn="tags">tags<p-sortIcon field="tags"></p-sortIcon>
            </th>
            <th> Action</th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-task let-rowIndex="rowIndex">
        <tr>
            <!-- <td>{{rowIndex +1 }}</td> -->
            <td>
                <div class="btn-toolbar mb-3">
                    <button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu" pButton
                        type="button" icon="pi pi-ellipsis-v" class="p-button-text p-button-sm " pTooltip="Edit Task"
                        tooltipPosition="top"></button>
                    <mat-menu #menu="matMenu">
                        <button (click)="showDetailTaskDialog(task,project)" mat-menu-item pButton label="Detail"
                            type=" button" icon="pi pi-info" class="p-button-text p-button-info p-button-sm"
                            pTooltip="info" tooltipPosition="top"></button>
                        <button (click)="showEditTaskDialog(task,project)" mat-menu-item pButton label="Edit"
                            type="button" icon="pi pi-ellipsis-v" class="p-button-text p-button-warning p-button-sm "
                            pTooltip="Edit Task" tooltipPosition="top"></button>
                        <button mat-menu-item pButton (click)="deleteConfirm(task.id,project)" type="button"
                            icon="pi pi-times-circle" class="p-button-text p-button-danger p-button-sm"
                            pTooltip="Delete" tooltipPosition="top" label="Delete"></button>
                    </mat-menu>
                </div>
            </td>
            <td pEditableColumn>
                <p-cellEditor>
                    <ng-template pTemplate="output">
                        <span *ngIf='task.name!=""; else noTitle'>{{task.name}}</span>
                        <ng-template #noTitle>Tap to edit</ng-template>
                    </ng-template>
                    <ng-template pTemplate="input">
                        <input (change)="onchowdate(project,task,1)" placeholder="{{task.name}}"
                            [(ngModel)]="taskToUpdate.name" pInputText type="text">
                    </ng-template>
                </p-cellEditor>

            </td>
            <td pEditableColumn>
                <p-cellEditor>
                    <ng-template pTemplate="output">
                        <span *ngIf='task.membres.length>0; else noMembers'>
                            <p-avatarGroup styleClass="p-mb-3">
                                <p-avatar pTooltip="{{member.firstName}} {{member.lastName}}" tooltipPosition="top"
                                    *ngFor="let member of task.membres| slice:0:3" image="assets/img/author-page.jpg"
                                    shape="circle">
                                </p-avatar>
                                <p-avatar *ngIf="task.membres.length >3" label="{{'+'}}{{task.membres.length-3}}"
                                    shape="circle" [style]="{'background-color':'#9c27b0', 'color': '#ffffff'}">
                                </p-avatar>
                            </p-avatarGroup>

                        </span>
                        <ng-template #noMembers>Tap to add</ng-template>
                    </ng-template>
                    <ng-template pTemplate="input">
                        <!-- <ng-select >
                            <ng-option *ngFor="let user of project.membres" [value]="user">{{user.firstName}} {{user.lastName}}</ng-option>
                         </ng-select> -->
                        <!-- <select multiple multiple  (change)="selectCar(task.membres)" [(ngModel)]="task.membres">
                            <option *ngFor="let user of project.membres" [value]="user" >{{user.firstName}} {{user.lastName}}</option>
                        </select> -->
                        <div class="p-inputgroup">
                            <mat-form-field appearance="fill">
                                <mat-label>Members</mat-label>
                                <mat-select [(ngModel)]="task.membres" multiple>
                                    <mat-option *ngFor="let user of project.membres" [value]="user">{{user.firstName}}
                                        {{user.lastName}}</mat-option>
                                </mat-select>
                            </mat-form-field>
                            <button (click)="onchowdate(project,task,8)" pButton type="button" icon="pi pi-check"
                                style="height: 50px;"
                                class="ml-1 p-button-success p-button-outlined p-button-sm"></button>
                        </div>
                    </ng-template>
                </p-cellEditor>

            </td>



            <td pEditableColumn>
                <p-cellEditor>
                    <ng-template pTemplate="output">
                        <ng-container *ngIf="task.priority==='MEDIUM'; else elseif1">
                            <p-tag styleClass="p-mr-2" severity="warning" value="{{task.priority}}"></p-tag>
                        </ng-container>
                        <ng-template #elseif1>
                            <ng-container *ngIf="task.priority==='HIGH'; else elseif4">
                                <p-tag styleClass="p-mr-2" severity="danger" value="{{task.priority}}"></p-tag>
                            </ng-container>
                        </ng-template>
                        <ng-container *ngIf="task.priority==='LOW'" #elseif4>
                            <p-tag styleClass="p-mr-2" severity="success" value="{{task.priority}}"></p-tag>
                        </ng-container>
                    </ng-template>
                    <ng-template pTemplate="input">
                        <p-dropdown (onChange)="onchowdate(project,task,6)" [(ngModel)]="taskToUpdate.priority"
                            placeholder="{{task.priority}}" [options]="prioritys" optionLabel="viewValue"
                            optionValue="value"></p-dropdown>
                    </ng-template>
                </p-cellEditor>
            </td>
            <td pEditableColumn>
                <p-cellEditor>
                    <ng-template pTemplate="output">
                        <ng-container *ngIf="task.status==='Not Started'; else elseif1">
                            <p-tag styleClass="p-mr-2" severity="warning" value="{{task.status}}"></p-tag>
                        </ng-container>
                        <ng-template #elseif1>
                            <ng-container *ngIf="task.status==='In Progress'; else elseif2">
                                <p-tag styleClass="p-mr-2" severity="" value="{{task.status}}"></p-tag>
                            </ng-container>
                        </ng-template>
                        <ng-template #elseif2>
                            <ng-container *ngIf="task.status==='On Hold'; else elseif3">
                                <p-tag styleClass="p-mr-2" severity="danger" value="{{task.status}}"></p-tag>
                            </ng-container>
                        </ng-template>
                        <ng-template #elseif3>
                            <ng-container *ngIf="task.status==='Cancelled'; else elseif4">
                                <p-tag styleClass="p-mr-2" severity="danger" value="{{task.status}}"></p-tag>
                            </ng-container>
                        </ng-template>
                        <ng-container *ngIf="task.status==='Finished'" #elseif4>
                            <p-tag styleClass="p-mr-2" severity="success" value="{{task.status}}"></p-tag>
                        </ng-container>
                    </ng-template>
                    <ng-template pTemplate="input">
                        <p-dropdown (onChange)="onchowdate(project,task,5)" [(ngModel)]="taskToUpdate.status"
                            placeholder="{{task.status}}" [options]="status" optionLabel="viewValue"
                            optionValue="value"></p-dropdown>
                    </ng-template>
                </p-cellEditor>
            </td>
            <td>
                <p-rating (onRate)="onchowdate(project,task,7)" [cancel]="false"
                    [readonly]="lc.getCurrentUser() === project.creator ?  false : true " [(ngModel)]="task.score">
                </p-rating>
            </td>
            <td pEditableColumn>
                <p-cellEditor>
                    <ng-template pTemplate="output">{{task.startDate}}</ng-template>
                    <ng-template pTemplate="input" class="btn-toolbar mb-2">
                        <!-- <input class="form-control" placeholder="yyyy-mm-dd" name="dp" ngbDatepicker #d="ngbDatepicker"> -->
                        <!-- <p-calendar (onSelect)="onchowdate(project,task,2)" dateFormat="yy-mm-dd"
                            [style]="{'width':'110%','border-color':'#4CAF50'}"
                            [panelStyle]="{'width':'320px','z-index': '-1'}" icon="pi pi-spin pi-spinner"
                            [showIcon]="true" [(ngModel)]="taskToUpdate.startDate">
                        </p-calendar> -->
                        <mat-form-field appearance="fill">
                            <input (dateChange)="onchowdate(project,task,2)" [(ngModel)]="taskToUpdate.startDate"
                                matInput [matDatepicker]="picker1">
                            <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                            <mat-datepicker [(ngModel)]="taskToUpdate.startDate" #picker1></mat-datepicker>
                        </mat-form-field>
                    </ng-template>
                </p-cellEditor>
            </td>
            <td pEditableColumn>
                <p-cellEditor>
                    <ng-template pTemplate="output">{{task.dueDate}}</ng-template>
                    <ng-template pTemplate="input" class="btn-toolbar mb-2">
                        <!-- <input class="form-control" placeholder="yyyy-mm-dd" name="dp" ngbDatepicker #d="ngbDatepicker"> -->
                        <!-- <p-calendar (onSelect)="onchowdate(project,task,3)" dateFormat="yy-mm-dd"
                            [style]="{'width':'110%','border-color':'#4CAF50'}"
                            [panelStyle]="{'width':'320px','z-index': '-1'}" icon="pi pi-spin pi-spinner"
                            [showIcon]="true" [(ngModel)]="taskToUpdate.dueDate">
                        </p-calendar> -->
                        <mat-form-field appearance="fill">
                            <input (dateChange)="onchowdate(project,task,3)" [(ngModel)]="taskToUpdate.dueDate" matInput
                                [matDatepicker]="picker2">
                            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                            <mat-datepicker #picker2></mat-datepicker>
                        </mat-form-field>
                    </ng-template>
                </p-cellEditor>
            </td>

            <td pEditableColumn>
                <p-cellEditor>
                    <ng-template pTemplate="output">
                        <span *ngIf='task.tags!=""; else notags'>{{task.tags}}</span>
                        <ng-template class="btn-info" #notags>Tap to edit</ng-template>
                    </ng-template>
                    <ng-template pTemplate="input">
                        <input placeholder="{{task.tags}}" (change)="onchowdate(project,task,4)"
                            [(ngModel)]="taskToUpdate.tags" pInputText type="text">
                    </ng-template>
                </p-cellEditor>

            </td>
            <td>
                <div class="btn-toolbar mb-3">
                    <button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu" pButton
                        type="button" icon="pi pi-ellipsis-v" class="p-button-text p-button-sm " pTooltip="Edit Task"
                        tooltipPosition="top"></button>
                    <mat-menu #menu="matMenu">
                        <button (click)="showDetailTaskDialog()" mat-menu-item pButton label="Detail" type=" button"
                            icon="pi pi-info" class="p-button-text p-button-info p-button-sm" pTooltip="info"
                            tooltipPosition="top"></button>
                        <button (click)="showEditTaskDialog()" mat-menu-item pButton label="Edit" type="button"
                            icon="pi pi-ellipsis-v" class="p-button-text p-button-warning p-button-sm "
                            pTooltip="Edit Task" tooltipPosition="top"></button>
                        <button mat-menu-item pButton (click)="deleteConfirm(task.id,project)" type="button"
                            icon="pi pi-times-circle" class="p-button-text p-button-danger p-button-sm"
                            pTooltip="Delete" tooltipPosition="top" label="Delete"></button>
                    </mat-menu>
                </div>
            </td>
        </tr>
    </ng-template>
    <ng-template pTemplate="footer">
        <tr>
            <td colspan="10">
                <button pButton type="button" icon="pi pi-plus" label="New"
                    class="p-button-outlined p-button-sm mt-4 ml-4" (click)="Newtask(project.id)"></button>
            </td>
        </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
        <tr>
            <td colspan="6">There are no order for this product yet.</td>
        </tr>
    </ng-template>
</p-table>
</div>
</td>
</tr>
</ng-template>
</p-table>